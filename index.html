<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Reporte de Problemas - Sistema Educacional</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    label { display: block; margin-top: 10px; }
    select, textarea, input { width: 100%; padding: 5px; margin-top: 5px; }
    button { margin: 10px 5px; padding: 10px 15px; }
    #consultaResultado { margin-top: 20px; font-weight: bold; }
  </style>
</head>
<body>

  <h1>Registro de Problemas o Fallas</h1>

  <form id="formReporte">
    <label>Nivel:</label>
    <select id="nivel" onchange="filtrarGrados()">
      <option value="">Seleccione...</option>
    </select>

    <label>Grado:</label>
    <select id="grado" onchange="filtrarGrupos()">
      <option value="">Seleccione...</option>
    </select>

    <label>Grupo:</label>
    <select id="grupo" onchange="filtrarClases()">
      <option value="">Seleccione...</option>
    </select>

    <label>Clase:</label>
    <select id="clase" onchange="mostrarDocenteMateria()">
      <option value="">Seleccione...</option>
    </select>

    <label>Materia:</label>
    <input type="text" id="materia" readonly>

    <label>Docente:</label>
    <input type="text" id="docente" readonly>

    <label>Fecha:</label>
    <input type="text" id="fecha" readonly>

    <label>Descripci√≥n del problema:</label>
    <textarea id="descripcion" rows="4"></textarea>

    <br>
    <button type="button" onclick="guardarReporte()">Guardar</button>
    <button type="reset">Borrar</button>
  </form>

  <h2>Consultar Estatus de Ticket</h2>
  <label>N√∫mero de Ticket:</label>
  <input type="number" id="ticketConsulta">
  <button type="button" onclick="consultarTicket()">Consultar</button>

  <div id="consultaResultado"></div>

  <script>
    // üìå URL de Google Apps Script
    const API_URL = "https://script.google.com/macros/s/AKfycbyDl1iaHWPLnuEp1-3d6QGHkPQOhieRj_UpOHcCDfSJvBvZ9VvPpMus71ZtqaG_-T2PIA/exec";

    // üìå Cat√°logo 
    const catalogo = [
  { "nivel": "Preescolar", "grado": "Kinder 1", "grupo": "Grupo A", "clase": "MatPre1A", "materia": "Matem√°ticas", "docente": "Irene Saucedo Ventura" },
  { "nivel": "Preescolar", "grado": "Kinder 1", "grupo": "Grupo A", "clase": "BilPre1A", "materia": "Bilingual Mission", "docente": "Martha Graciela Posadas Navarro" },
  { "nivel": "Preescolar", "grado": "Kinder 1", "grupo": "Grupo B", "clase": "MatPre1B", "materia": "Matem√°ticas", "docente": "Reyna Rivera Garc√≠a" },
  { "nivel": "Preescolar", "grado": "Kinder 1", "grupo": "Grupo B", "clase": "BilPre1B", "materia": "Bilingual Mission", "docente": "Mar√≠a Teresa Valdez L√≥pez" },
  { "nivel": "Preescolar", "grado": "Kinder 2", "grupo": "Grupo A", "clase": "MatPre2A", "materia": "Matem√°ticas", "docente": "Erika Garc√≠a Mej√≠a" },
  { "nivel": "Preescolar", "grado": "Kinder 2", "grupo": "Grupo A", "clase": "BilPre2A", "materia": "Bilingual Mission", "docente": "Claudia Patricia Moreno Ram√≠rez" },
  { "nivel": "Preescolar", "grado": "Kinder 2", "grupo": "Grupo B", "clase": "MatPre2B", "materia": "Matem√°ticas", "docente": "Mar√≠a Fernanda Aguirre Ch√°vez" },
  { "nivel": "Preescolar", "grado": "Kinder 2", "grupo": "Grupo B", "clase": "BilPre2B", "materia": "Bilingual Mission", "docente": "Alejandra Z√°rate L√≥pez" },
  { "nivel": "Preescolar", "grado": "Kinder 3", "grupo": "Grupo A", "clase": "MatPre3A", "materia": "Matem√°ticas", "docente": "Daniela Romero R√≠os" },
  { "nivel": "Preescolar", "grado": "Kinder 3", "grupo": "Grupo A", "clase": "BilPre3A", "materia": "Bilingual Mission", "docente": "Gabriela Jim√©nez Hern√°ndez" },
  { "nivel": "Preescolar", "grado": "Kinder 3", "grupo": "Grupo B", "clase": "MatPre3B", "materia": "Matem√°ticas", "docente": "Karen Rodr√≠guez Flores" },
  { "nivel": "Preescolar", "grado": "Kinder 3", "grupo": "Grupo B", "clase": "BilPre3B", "materia": "Bilingual Mission", "docente": "Paola M√©ndez Guti√©rrez" },

  { "nivel": "Primaria", "grado": "1¬∫- Primero Primaria", "grupo": "Grupo A", "clase": "MatPri1A", "materia": "Matem√°ticas", "docente": "Itzel Guadalupe √Åvila Ruiz" },
  { "nivel": "Primaria", "grado": "1¬∫- Primero Primaria", "grupo": "Grupo B", "clase": "MatPri1B", "materia": "Matem√°ticas", "docente": "Roberto Hern√°ndez L√≥pez" },
  { "nivel": "Primaria", "grado": "2¬∫- Segundo Primaria", "grupo": "Grupo A", "clase": "MatPri2A", "materia": "Matem√°ticas", "docente": "Daniela S√°nchez Mart√≠nez" },
  { "nivel": "Primaria", "grado": "2¬∫- Segundo Primaria", "grupo": "Grupo B", "clase": "MatPri2B", "materia": "Matem√°ticas", "docente": "Jos√© Luis Morales P√©rez" },
  { "nivel": "Primaria", "grado": "3¬∫- Tercero Primaria", "grupo": "Grupo A", "clase": "MatPri3A", "materia": "Matem√°ticas", "docente": "Ver√≥nica Castillo Ram√≠rez" },
  { "nivel": "Primaria", "grado": "3¬∫- Tercero Primaria", "grupo": "Grupo B", "clase": "MatPri3B", "materia": "Matem√°ticas", "docente": "Francisco Javier Ortega D√≠az" },
  { "nivel": "Primaria", "grado": "4¬∫- Cuarto Primaria", "grupo": "Grupo A", "clase": "MatPri4A", "materia": "Matem√°ticas", "docente": "Mar√≠a Fernanda Torres Aguilar" },
  { "nivel": "Primaria", "grado": "4¬∫- Cuarto Primaria", "grupo": "Grupo B", "clase": "MatPri4B", "materia": "Matem√°ticas", "docente": "Eduardo S√°nchez Ram√≠rez" },
  { "nivel": "Primaria", "grado": "5¬∫- Quinto Primaria", "grupo": "Grupo A", "clase": "MatPri5A", "materia": "Matem√°ticas", "docente": "Patricia Hern√°ndez G√≥mez" },
  { "nivel": "Primaria", "grado": "5¬∫- Quinto Primaria", "grupo": "Grupo B", "clase": "MatPri5B", "materia": "Matem√°ticas", "docente": "Roc√≠o Garc√≠a Flores" },
  { "nivel": "Primaria", "grado": "6¬∫- Sexto Primaria", "grupo": "Grupo A", "clase": "MatPri6A", "materia": "Matem√°ticas", "docente": "Carlos Ram√≠rez Ortega" },
  { "nivel": "Primaria", "grado": "6¬∫- Sexto Primaria", "grupo": "Grupo B", "clase": "MatPri6B", "materia": "Matem√°ticas", "docente": "Alejandra Ruiz Hern√°ndez" },

  { "nivel": "Secundaria", "grado": "1¬∫- Primero Secundaria", "grupo": "Grupo A", "clase": "MatSec1A", "materia": "Matem√°ticas", "docente": "Marco Eduardo Ram√≠rez de la Cruz" },
  { "nivel": "Secundaria", "grado": "1¬∫- Primero Secundaria", "grupo": "Grupo B", "clase": "MatSec1B", "materia": "Matem√°ticas", "docente": "Sandra L√≥pez M√°rquez" },
  { "nivel": "Secundaria", "grado": "2¬∫- Segundo Secundaria", "grupo": "Grupo A", "clase": "MatSec2A", "materia": "Matem√°ticas", "docente": "Jorge Hern√°ndez Casta√±eda" },
  { "nivel": "Secundaria", "grado": "2¬∫- Segundo Secundaria", "grupo": "Grupo B", "clase": "MatSec2B", "materia": "Matem√°ticas", "docente": "Mariana P√©rez Guti√©rrez" },
  { "nivel": "Secundaria", "grado": "3¬∫- Tercero Secundaria", "grupo": "Grupo A", "clase": "MatSec3A", "materia": "Matem√°ticas", "docente": "H√©ctor Gonz√°lez Ram√≠rez" },
  { "nivel": "Secundaria", "grado": "3¬∫- Tercero Secundaria", "grupo": "Grupo B", "clase": "MatSec3B", "materia": "Matem√°ticas", "docente": "Luc√≠a Hern√°ndez Ortega" }
];

    // Llenar niveles √∫nicos
    const niveles = [...new Set(catalogo.map(c => c.nivel))];
    const nivelSelect = document.getElementById("nivel");
    niveles.forEach(n => {
      const option = document.createElement("option");
      option.value = n;
      option.textContent = n;
      nivelSelect.appendChild(option);
    });

    function filtrarGrados() {
      const gradoSelect = document.getElementById("grado");
      gradoSelect.innerHTML = "<option value=''>Seleccione...</option>";
      const grupos = document.getElementById("grupo");
      grupos.innerHTML = "<option value=''>Seleccione...</option>";
      const clases = document.getElementById("clase");
      clases.innerHTML = "<option value=''>Seleccione...</option>";

      const seleccion = document.getElementById("nivel").value;
      const grados = [...new Set(catalogo.filter(c => c.nivel === seleccion).map(c => c.grado))];
      grados.forEach(g => {
        const option = document.createElement("option");
        option.value = g;
        option.textContent = g;
        gradoSelect.appendChild(option);
      });
    }

    function filtrarGrupos() {
      const grupoSelect = document.getElementById("grupo");
      grupoSelect.innerHTML = "<option value=''>Seleccione...</option>";
      const clases = document.getElementById("clase");
      clases.innerHTML = "<option value=''>Seleccione...</option>";

      const seleccionNivel = document.getElementById("nivel").value;
      const seleccionGrado = document.getElementById("grado").value;
      const grupos = [...new Set(catalogo.filter(c => c.nivel === seleccionNivel && c.grado === seleccionGrado).map(c => c.grupo))];
      grupos.forEach(g => {
        const option = document.createElement("option");
        option.value = g;
        option.textContent = g;
        grupoSelect.appendChild(option);
      });
    }

    function filtrarClases() {
      const claseSelect = document.getElementById("clase");
      claseSelect.innerHTML = "<option value=''>Seleccione...</option>";

      const seleccionNivel = document.getElementById("nivel").value;
      const seleccionGrado = document.getElementById("grado").value;
      const seleccionGrupo = document.getElementById("grupo").value;
      const clases = catalogo.filter(c => c.nivel === seleccionNivel && c.grado === seleccionGrado && c.grupo === seleccionGrupo);
      clases.forEach(cl => {
        const option = document.createElement("option");
        option.value = cl.clase;
        option.textContent = cl.clase;
        claseSelect.appendChild(option);
      });
    }

    function mostrarDocenteMateria() {
      const seleccionClase = document.getElementById("clase").value;
      const item = catalogo.find(c => c.clase === seleccionClase);
      if (item) {
        document.getElementById("materia").value = item.materia;
        document.getElementById("docente").value = item.docente;
      }
    }

    function guardarReporte() {
      const nivel = document.getElementById("nivel").value;
      const grado = document.getElementById("grado").value;
      const grupo = document.getElementById("grupo").value;
      const clase = document.getElementById("clase").value;
      const materia = document.getElementById("materia").value;
      const docente = document.getElementById("docente").value;
      const descripcion = document.getElementById("descripcion").value;
      const fecha = new Date().toLocaleDateString();

      if (!nivel || !grado || !grupo || !clase || !descripcion) {
        alert("‚ö†Ô∏è Complete todos los campos.");
        return;
      }

      const reporte = { action: "guardar", nivel, grado, grupo, clase, materia, docente, fecha, descripcion };

      fetch(API_URL, {
        method: "POST",
        body: JSON.stringify(reporte)
      })
      .then(res => res.json())
      .then(data => {
        if (data.success) {
          alert("‚úÖ Reporte enviado correctamente. Ticket: " + data.ticket);
          document.getElementById("formReporte").reset();
          document.getElementById("fecha").value = fecha;
        } else {
          alert("‚ùå Error al guardar.");
        }
      })
      .catch(() => alert("‚ùå Error de conexi√≥n."));
    }

    function consultarTicket() {
      const ticket = document.getElementById("ticketConsulta").value;
      if (!ticket) {
        alert("Ingrese un n√∫mero de ticket.");
        return;
      }

      fetch(API_URL, {
        method: "POST",
        body: JSON.stringify({ action: "consultar", ticket: ticket })
      })
      .then(res => res.json())
      .then(data => {
        const div = document.getElementById("consultaResultado");
        if (data.success) {
          div.innerHTML = "üìå Estatus: " + data.estatus + "<br>üìù Comentarios: " + data.comentarios;
        } else {
          div.innerHTML = "‚ùå " + data.message;
        }
      })
      .catch(() => alert("‚ùå Error de conexi√≥n."));
    }

    // Setear fecha actual
    document.getElementById("fecha").value = new Date().toLocaleDateString();
  </script>
</body>
</html>
