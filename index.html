<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Registro y Consulta de Errores - UNOi - CIMA</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    /* ------------------------------------- */
    /* ESTILOS BASE Y VARIABLES */
    /* ------------------------------------- */
    :root {
      --color-primary: #4CAF50; /* Guardar (Verde) */
      --color-warning: #f39c12; /* Borrar (Naranja) */
      --color-danger: #e74c3c; /* Cancelar (Rojo) */
      --color-text: #333;
      --color-bg: #f9f9f9;
      --color-card: #fff;
      --color-accent: #3498db; /* Azul para Consulta */
    }
    
    body { font-family: Arial, sans-serif; margin: 0; padding: 20px; background: var(--color-bg); }
    h2 { color: var(--color-text); margin-top: 0; }
    
    /* Contenedor principal para responsive */
    .container {
      max-width: 700px;
      margin: 0 auto;
    }

    /* Estilo de los formularios */
    .form-box { 
      background: var(--color-card); 
      padding: 15px; 
      border-radius: 8px; 
      box-shadow: 0 0 10px rgba(0,0,0,0.1); 
      margin-bottom: 25px;
    }
    
    label { display: block; margin: 8px 0 4px; font-weight: bold; }
    select, textarea, input[type="text"], input[type="number"] {
      width: 100%; 
      padding: 10px; 
      border: 1px solid #ccc; 
      border-radius: 4px;
      box-sizing: border-box; /* Crucial para responsive */
    }
    textarea { resize: vertical; }
    input[readonly] { background-color: #eee; cursor: not-allowed; }
    select:disabled { background-color: #f0f0f0; } /* Estilo para select deshabilitado */

    /* Estilos de botones */
    .buttons { margin-top: 15px; display: flex; flex-wrap: wrap; gap: 10px; }
    button { 
      flex-grow: 1; 
      padding: 10px 15px; 
      border: none; 
      border-radius: 4px; 
      cursor: pointer; 
      transition: background 0.3s;
      color: white;
      font-weight: bold;
      min-width: 100px;
    }
    
    button.guardar { background: var(--color-primary); }
    button.borrar { background: var(--color-warning); }
    button.cancelar { background: var(--color-danger); }
    button.consultar { background: var(--color-accent); }
    button:disabled { background-color: #ccc !important; cursor: wait; }

    /* ------------------------------------- */
    /* SECCIÓN DE CONSULTA ESPECÍFICA */
    /* ------------------------------------- */
    #consultaResultado {
      margin-top: 15px;
      padding: 10px;
      border-left: 5px solid var(--color-accent);
      background-color: #ecf0f1;
      border-radius: 4px;
    }
    #consultaResultado p { margin: 5px 0; }
    #consultaResultado strong { color: var(--color-accent); }
    .status-pendiente { color: var(--color-danger); }
    .status-resuelto { color: var(--color-primary); }
    .status-enproceso { color: var(--color-warning); }

    /* ------------------------------------- */
    /* MODAL DE NOTIFICACIÓN */
    /* ------------------------------------- */
    .modal-backdrop {
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0, 0, 0, 0.5);
      display: none; 
      justify-content: center;
      align-items: center;
      z-index: 1000;
    }

    .modal-content {
      background: var(--color-card);
      padding: 25px;
      border-radius: 8px;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
      width: 90%;
      max-width: 400px;
      text-align: center;
      animation: fadeIn 0.3s;
    }

    .modal-icon { font-size: 40px; margin-bottom: 10px; }
    .modal-ok-button { 
      background: var(--color-accent); 
      margin-top: 15px; 
      width: 100%;
    }

    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(-20px); }
        to { opacity: 1; transform: translateY(0); }
    }
    
    /* ------------------------------------- */
    /* RESPONSIVE DESIGN (MEJORAS PARA MÓVIL) */
    /* ------------------------------------- */
    @media (min-width: 600px) {
      .buttons button {
        flex-grow: 0;
        width: auto;
      }
    }
  </style>
</head>
<body>

  <div class="container">
    
    <div class="form-box">
      <h2>Registro y Consulta de Errores - UNOi - CIMA</h2>
      <form id="formReporte">
        
        <label>Docente:</label>
        <select id="docente" required>
          <option value="">Seleccione...</option>
        </select>

        <label>Clase:</label>
        <select id="clase" required disabled>
          <option value="">Seleccione...</option>
        </select>

        <label>Nivel:</label>
        <input type="text" id="nivel" readonly>

        <label>Grado:</label>
        <input type="text" id="grado" readonly>

        <label>Grupo:</label>
        <input type="text" id="grupo" readonly>

        <label>Materia:</label>
        <input type="text" id="materia" readonly>

        <label>Fecha del reporte:</label>
        <input type="text" id="fecha" readonly>

        <label>Problema o Falla:</label>
        <textarea id="descripcion" rows="4" placeholder="Describa el problema..." required></textarea>

        <div class="buttons">
          <button type="submit" class="guardar">Guardar Reporte</button>
          <button type="button" class="borrar" onclick="limpiarFormulario()">Borrar Campos</button>
          <button type="button" class="cancelar" onclick="cancelar()">Cancelar</button>
        </div>
      </form>
    </div>

    <div class="form-box">
      <h2>Consulta de Estado del Ticket</h2>
      <form id="formConsulta">
        <label>Número de Ticket:</label>
        <input type="number" id="ticketConsulta" placeholder="Escriba el número de ticket" required min="1">
        
        <div class="buttons">
          <button type="submit" class="consultar">Consultar Estado</button>
        </div>
        
        <div id="consultaResultado">
          <p>Estatus:</p>
          <p>Comentarios:</p>
        </div>
      </form>
    </div>

  </div> <div id="notificacionModal" class="modal-backdrop" onclick="this.style.display='none'">
    <div class="modal-content" onclick="event.stopPropagation()">
      <div id="modalIcon" class="modal-icon"></div>
      <h3 id="modalTitle"></h3>
      <p id="modalMessage"></p>
      <button class="modal-ok-button" onclick="document.getElementById('notificacionModal').style.display='none'">Aceptar</button>
    </div>
  </div>


  <script>
    // URL de tu Google Apps Script
    const API_URL = "https://script.google.com/macros/s/AKfycbyDl1iaHWPLnuEp1-3d6QGHkPQOhieRj_UpOHcCDfSJvBvZ9VvPpMus71ZtqaG_-T2PIA/exec";

    // ⚠️ Catálogo de Datos (tu array completo)
    const catalogo = [
  {
    "nivel": "Preescolar",
    "grado": "Kinder 1",
    "grupo": "grupo A",
    "clase": "1° A Matemáticas Preescolar",
    "Clase Clave": "MatPre1A",
    "Alias": "Matemáticas 1A",
    "materia": "Matemáticas",
    "docente": "Irene Saucedo Ventura"
  },
  {
    "nivel": "Preescolar",
    "grado": "Kinder 1",
    "grupo": "grupo A",
    "clase": "1° A Bilingual Mission Preescolar",
    "Clase Clave": "BilPre1A",
    "Alias": "Bilingual Mission 1A",
    "materia": "Bilingual Mission",
    "docente": "Martha Graciela Posadas Navarro"
  },
  {
    "nivel": "Preescolar",
    "grado": "Kinder 1",
    "grupo": "grupo A",
    "clase": "1° A Zona D Preescolar",
    "Clase Clave": "ZonPre1A",
    "Alias": "Zona D 1A",
    "materia": "Zona D",
    "docente": "Irene Saucedo Ventura"
  },
  {
    "nivel": "Preescolar",
    "grado": "Kinder 1",
    "grupo": "grupo A",
    "clase": "1° A Escritura Preescolar",
    "Clase Clave": "EscPre1A",
    "Alias": "Escritura 1A",
    "materia": "Escritura",
    "docente": "Irene Saucedo Ventura"
  },
  {
    "nivel": "Preescolar",
    "grado": "Kinder 2",
    "grupo": "grupo A",
    "clase": "2° A Matemáticas Preescolar",
    "Clase Clave": "MatPre2A",
    "Alias": "Matemáticas 2A",
    "materia": "Matemáticas",
    "docente": "Rita Fabiola González Rojas"
  },
  {
    "nivel": "Preescolar",
    "grado": "Kinder 2",
    "grupo": "grupo A",
    "clase": "2° A Bilingual Mission Preescolar",
    "Clase Clave": "BilPre2A",
    "Alias": "Bilingual Mission 2A",
    "materia": "Bilingual Mission",
    "docente": "Karla Lilia Baños Castro"
  },
  {
    "nivel": "Preescolar",
    "grado": "Kinder 2",
    "grupo": "grupo A",
    "clase": "2° A Zona D Preescolar",
    "Clase Clave": "ZonPre2A",
    "Alias": "Zona D 2A",
    "materia": "Zona D",
    "docente": "Rita Fabiola González Rojas"
  },
  {
    "nivel": "Preescolar",
    "grado": "Kinder 2",
    "grupo": "grupo A",
    "clase": "2° A Escritura Preescolar",
    "Clase Clave": "EscPre2A",
    "Alias": "Escritura 2A",
    "materia": "Escritura",
    "docente": "Rita Fabiola González Rojas"
  },
  {
    "nivel": "Preescolar",
    "grado": "Kinder 3",
    "grupo": "grupo A",
    "clase": "3° A Matemáticas Preescolar",
    "Clase Clave": "MatPre3A",
    "Alias": "Matemáticas 3A",
    "materia": "Matemáticas",
    "docente": "María Lizbeth Cardenas Reyes"
  },
  {
    "nivel": "Preescolar",
    "grado": "Kinder 3",
    "grupo": "grupo A",
    "clase": "3° A Bilingual Mission Preescolar",
    "Clase Clave": "BilPre3A",
    "Alias": "Bilingual Mission 3A",
    "materia": "Bilingual Mission",
    "docente": "Karla Lilia Baños Castro"
  },
  {
    "nivel": "Preescolar",
    "grado": "Kinder 3",
    "grupo": "grupo A",
    "clase": "3° A Zona D Preescolar",
    "Clase Clave": "ZonPre3A",
    "Alias": "Zona D 3A",
    "materia": "Zona D",
    "docente": "María Lizbeth Cardenas Reyes"
  },
  {
    "nivel": "Preescolar",
    "grado": "Kinder 3",
    "grupo": "grupo A",
    "clase": "3° A Escritura Preescolar",
    "Clase Clave": "EscPre3A",
    "Alias": "Escritura 3A",
    "materia": "Escritura",
    "docente": "María Lizbeth Cardenas Reyes"
  },
  {
    "nivel": "Preescolar",
    "grado": "Kinder 1",
    "grupo": "grupo B",
    "clase": "1° B Matemáticas Preescolar",
    "Clase Clave": "MatPre1B",
    "Alias": "Matemáticas 1B",
    "materia": "Matemáticas",
    "docente": "María Lizbeth Cardenas Reyes"
  },
  {
    "nivel": "Preescolar",
    "grado": "Kinder 2",
    "grupo": "grupo B",
    "clase": "2° B Matemáticas Preescolar",
    "Clase Clave": "MatPre2B",
    "Alias": "Matemáticas 2",
    "materia": "Matemáticas",
    "docente": "Rita Fabiola González Rojas"
  },
  {
    "nivel": "Preescolar",
    "grado": "Kinder 1",
    "grupo": "grupo B",
    "clase": "1° B Bilingual Mission Preescolar",
    "Clase Clave": "BilPre1B",
    "Alias": "Bilingual Mission 1B",
    "materia": "Bilingual Mission",
    "docente": "Irene Saucedo Ventura"
  },
  {
    "nivel": "Preescolar",
    "grado": "Kinder 2",
    "grupo": "grupo B",
    "clase": "2° B Bilingual Mission Preescolar",
    "Clase Clave": "BilPre2B",
    "Alias": "Bilingual Mission 2B",
    "materia": "Bilingual Mission",
    "docente": "Irene Saucedo Ventura"
  },
  {
    "nivel": "Preescolar",
    "grado": "Kinder 1",
    "grupo": "grupo B",
    "clase": "1° B Zona D Preescolar",
    "Clase Clave": "ZonPre1B",
    "Alias": "Zona D 1B",
    "materia": "Zona D",
    "docente": "María Lizbeth Cardenas Reyes"
  },
  {
    "nivel": "Preescolar",
    "grado": "Kinder 2",
    "grupo": "grupo B",
    "clase": "2° B Zona D Preescolar",
    "Clase Clave": "ZonPre2B",
    "Alias": "Zona D 2B",
    "materia": "Zona D",
    "docente": "Rita Fabiola González Rojas"
  },
  {
    "nivel": "Preescolar",
    "grado": "Kinder 1",
    "grupo": "grupo B",
    "clase": "1° B Escritura Preescolar",
    "Clase Clave": "EscPre1B",
    "Alias": "Escritura 1B",
    "materia": "Escritura",
    "docente": "María Lizbeth Cardenas Reyes"
  },
  {
    "nivel": "Preescolar",
    "grado": "Kinder 2",
    "grupo": "grupo B",
    "clase": "2° B Escritura Preescolar",
    "Clase Clave": "EscPre2B",
    "Alias": "Escritura 2B",
    "materia": "Escritura",
    "docente": "Rita Fabiola González Rojas"
  },
  {
    "nivel": "Primaria",
    "grado": "1º- Primero Primaria",
    "grupo": "grupo A",
    "clase": "1° A Español Primaria",
    "Clase Clave": "EspPri1A",
    "Alias": "Español 1",
    "materia": "Lengua Materna. Español",
    "docente": "Itzel Guadalupe Ávila Ruiz"
  },
  {
    "nivel": "Primaria",
    "grado": "1º- Primero Primaria",
    "grupo": "grupo A",
    "clase": "1° A Matemáticas Primaria",
    "Clase Clave": "MatPri1A",
    "Alias": "Matemáticas 1",
    "materia": "Matemáticas",
    "docente": "Itzel Guadalupe Ávila Ruiz"
  },
  {
    "nivel": "Primaria",
    "grado": "1º- Primero Primaria",
    "grupo": "grupo A",
    "clase": "1° A Conocimiento del Medio Primaria",
    "Clase Clave": "ConPri1A",
    "Alias": "Conocimiento del Medio 1",
    "materia": "Conocimiento del Medio",
    "docente": "Itzel Guadalupe Ávila Ruiz"
  },
  {
    "nivel": "Primaria",
    "grado": "1º- Primero Primaria",
    "grupo": "grupo A",
    "clase": "1° A Formación Cívica y Ética Primaria",
    "Clase Clave": "ForPri1A",
    "Alias": "Formación Cívica y Ética 1",
    "materia": "Formación Cívica y Ética",
    "docente": "Itzel Guadalupe Ávila Ruiz"
  },
  {
    "nivel": "Primaria",
    "grado": "2º- Segundo Primaria",
    "grupo": "grupo A",
    "clase": "2° A Español Primaria",
    "Clase Clave": "EspPri2A",
    "Alias": "Español 2",
    "materia": "Lengua Materna. Español",
    "docente": "Itzel Guadalupe Ávila Ruiz"
  },
  {
    "nivel": "Primaria",
    "grado": "2º- Segundo Primaria",
    "grupo": "grupo A",
    "clase": "2° A Matemáticas Primaria",
    "Clase Clave": "MatPri2A",
    "Alias": "Matemáticas 2",
    "materia": "Matemáticas",
    "docente": "Itzel Guadalupe Ávila Ruiz"
  },
  {
    "nivel": "Primaria",
    "grado": "2º- Segundo Primaria",
    "grupo": "grupo A",
    "clase": "2° A Conocimiento del Medio Primaria",
    "Clase Clave": "ConPri2A",
    "Alias": "Conocimiento del Medio 2",
    "materia": "Conocimiento del Medio",
    "docente": "Itzel Guadalupe Ávila Ruiz"
  },
  {
    "nivel": "Primaria",
    "grado": "2º- Segundo Primaria",
    "grupo": "grupo A",
    "clase": "2° A Formación Cívica y Ética Primaria",
    "Clase Clave": "ForPri2A",
    "Alias": "Formación Cívica y Ética 2",
    "materia": "Formación Cívica y Ética",
    "docente": "Itzel Guadalupe Ávila Ruiz"
  },
  {
    "nivel": "Primaria",
    "grado": "3º- Tercero Primaria",
    "grupo": "grupo A",
    "clase": "3° A Español Primaria",
    "Clase Clave": "EspPri3A",
    "Alias": "Español 3",
    "materia": "Lengua Materna. Español",
    "docente": "María Guadalupe Soto Sezati"
  },
  {
    "nivel": "Primaria",
    "grado": "3º- Tercero Primaria",
    "grupo": "grupo A",
    "clase": "3° A Matemáticas Primaria",
    "Clase Clave": "MatPri3A",
    "Alias": "Matemáticas 3",
    "materia": "Matemáticas",
    "docente": "María Guadalupe Soto Sezati"
  },
  {
    "nivel": "Primaria",
    "grado": "3º- Tercero Primaria",
    "grupo": "grupo A",
    "clase": "3° A Conocimiento del Medio Primaria",
    "Clase Clave": "ConPri3A",
    "Alias": "Conocimiento del Medio 3",
    "materia": "Conocimiento del Medio",
    "docente": "María Guadalupe Soto Sezati"
  },
  {
    "nivel": "Primaria",
    "grado": "3º- Tercero Primaria",
    "grupo": "grupo A",
    "clase": "3° A Formación Cívica y Ética Primaria",
    "Clase Clave": "ForPri3A",
    "Alias": "Formación Cívica y Ética 3",
    "materia": "Formación Cívica y Ética",
    "docente": "María Guadalupe Soto Sezati"
  },
  {
    "nivel": "Primaria",
    "grado": "3º- Tercero Primaria",
    "grupo": "grupo A",
    "clase": "3° A Geografía Primaria",
    "Clase Clave": "GeoPri3A",
    "Alias": "Geografía 3",
    "materia": "Geografía",
    "docente": "María Guadalupe Soto Sezati"
  },
  {
    "nivel": "Primaria",
    "grado": "4º- Cuarto Primaria",
    "grupo": "grupo A",
    "clase": "4° A Español Primaria",
    "Clase Clave": "EspPri4A",
    "Alias": "Español 4",
    "materia": "Lengua Materna. Español",
    "docente": "María Guadalupe Soto Sezati"
  },
  {
    "nivel": "Primaria",
    "grado": "4º- Cuarto Primaria",
    "grupo": "grupo A",
    "clase": "4° A Matemáticas Primaria",
    "Clase Clave": "MatPri4A",
    "Alias": "Matemáticas 4",
    "materia": "Matemáticas",
    "docente": "María Guadalupe Soto Sezati"
  },
  {
    "nivel": "Primaria",
    "grado": "4º- Cuarto Primaria",
    "grupo": "grupo A",
    "clase": "4° A Conocimiento del Medio Primaria",
    "Clase Clave": "ConPri4A",
    "Alias": "Conocimiento del Medio 4",
    "materia": "Conocimiento del Medio",
    "docente": "María Guadalupe Soto Sezati"
  },
  {
    "nivel": "Primaria",
    "grado": "4º- Cuarto Primaria",
    "grupo": "grupo A",
    "clase": "4° A Formación Cívica y Ética Primaria",
    "Clase Clave": "ForPri4A",
    "Alias": "Formación Cívica y Ética 4",
    "materia": "Formación Cívica y Ética",
    "docente": "María Guadalupe Soto Sezati"
  },
  {
    "nivel": "Primaria",
    "grado": "4º- Cuarto Primaria",
    "grupo": "grupo A",
    "clase": "4° A Geografía Primaria",
    "Clase Clave": "GeoPri4A",
    "Alias": "Geografía 4",
    "materia": "Geografía",
    "docente": "María Guadalupe Soto Sezati"
  },
  {
    "nivel": "Primaria",
    "grado": "4º- Cuarto Primaria",
    "grupo": "grupo A",
    "clase": "4° A Historia Primaria",
    "Clase Clave": "HisPri4A",
    "Alias": "Historia 4",
    "materia": "Historia",
    "docente": "María Guadalupe Soto Sezati"
  },
  {
    "nivel": "Primaria",
    "grado": "5º- Quinto Primaria",
    "grupo": "grupo A",
    "clase": "5° A Español Primaria",
    "Clase Clave": "EspPri5A",
    "Alias": "Español 5",
    "materia": "Lengua Materna. Español",
    "docente": "Marco Eduardo Ramírez de la Cruz"
  },
  {
    "nivel": "Primaria",
    "grado": "5º- Quinto Primaria",
    "grupo": "grupo A",
    "clase": "5° A Matemáticas Primaria",
    "Clase Clave": "MatPri5A",
    "Alias": "Matemáticas 5",
    "materia": "Matemáticas",
    "docente": "Marco Eduardo Ramírez de la Cruz"
  },
  {
    "nivel": "Primaria",
    "grado": "5º- Quinto Primaria",
    "grupo": "grupo A",
    "clase": "5° A Conocimiento del Medio Primaria",
    "Clase Clave": "ConPri5A",
    "Alias": "Conocimiento del Medio 5",
    "materia": "Conocimiento del Medio",
    "docente": "Marco Eduardo Ramírez de la Cruz"
  },
  {
    "nivel": "Primaria",
    "grado": "5º- Quinto Primaria",
    "grupo": "grupo A",
    "clase": "5° A Formación Cívica y Ética Primaria",
    "Clase Clave": "ForPri5A",
    "Alias": "Formación Cívica y Ética 5",
    "materia": "Formación Cívica y Ética",
    "docente": "Marco Eduardo Ramírez de la Cruz"
  },
  {
    "nivel": "Primaria",
    "grado": "5º- Quinto Primaria",
    "grupo": "grupo A",
    "clase": "5° A Geografía Primaria",
    "Clase Clave": "GeoPri5A",
    "Alias": "Geografía 5",
    "materia": "Geografía",
    "docente": "Marco Eduardo Ramírez de la Cruz"
  },
  {
    "nivel": "Primaria",
    "grado": "5º- Quinto Primaria",
    "grupo": "grupo A",
    "clase": "5° A Historia Primaria",
    "Clase Clave": "HisPri5A",
    "Alias": "Historia 5",
    "materia": "Historia",
    "docente": "Marco Eduardo Ramírez de la Cruz"
  },
  {
    "nivel": "Primaria",
    "grado": "6º- Sexto Primaria",
    "grupo": "grupo A",
    "clase": "6° A Español Primaria",
    "Clase Clave": "EspPri6A",
    "Alias": "Español 6",
    "materia": "Lengua Materna. Español",
    "docente": "Marco Eduardo Ramírez de la Cruz"
  },
  {
    "nivel": "Primaria",
    "grado": "6º- Sexto Primaria",
    "grupo": "grupo A",
    "clase": "6° A Matemáticas Primaria",
    "Clase Clave": "MatPri6A",
    "Alias": "Matemáticas 6",
    "materia": "Matemáticas",
    "docente": "Marco Eduardo Ramírez de la Cruz"
  },
  {
    "nivel": "Primaria",
    "grado": "6º- Sexto Primaria",
    "grupo": "grupo A",
    "clase": "6° A Conocimiento del Medio Primaria",
    "Clase Clave": "ConPri6A",
    "Alias": "Conocimiento del Medio 6",
    "materia": "Conocimiento del Medio",
    "docente": "Marco Eduardo Ramírez de la Cruz"
  },
  {
    "nivel": "Primaria",
    "grado": "6º- Sexto Primaria",
    "grupo": "grupo A",
    "clase": "6° A Formación Cívica y Ética Primaria",
    "Clase Clave": "ForPri6A",
    "Alias": "Formación Cívica y Ética 6",
    "materia": "Formación Cívica y Ética",
    "docente": "Marco Eduardo Ramírez de la Cruz"
  },
  {
    "nivel": "Primaria",
    "grado": "6º- Sexto Primaria",
    "grupo": "grupo A",
    "clase": "6° A Geografía Primaria",
    "Clase Clave": "GeoPri6A",
    "Alias": "Geografía 6",
    "materia": "Geografía",
    "docente": "Marco Eduardo Ramírez de la Cruz"
  },
  {
    "nivel": "Primaria",
    "grado": "6º- Sexto Primaria",
    "grupo": "grupo A",
    "clase": "6° A Historia Primaria",
    "Clase Clave": "HisPri6A",
    "Alias": "Historia 6",
    "materia": "Historia",
    "docente": "Marco Eduardo Ramírez de la Cruz"
  },
  {
    "nivel": "Secundaria",
    "grado": "1º- Primero Secundaria",
    "grupo": "grupo A",
    "clase": "1° A Matemáticas Secundaria",
    "Clase Clave": "MatSec1A",
    "Alias": "Matemáticas 1",
    "materia": "Matemáticas",
    "docente": "Marco Eduardo Ramírez de la Cruz"
  },
  {
    "nivel": "Secundaria",
    "grado": "1º- Primero Secundaria",
    "grupo": "grupo A",
    "clase": "1° A Ciencias y tecnología. Biología Secundaria",
    "Clase Clave": "CieSec1A",
    "Alias": "Biología 1",
    "materia": "Ciencias y tecnología. Biología",
    "docente": "Victor Hugo Vargas Velásquez"
  },
  {
    "nivel": "Secundaria",
    "grado": "1º- Primero Secundaria",
    "grupo": "grupo A",
    "clase": "1° A Formación Cívica y Ética Secundaria",
    "Clase Clave": "ForSec1A",
    "Alias": "Formación Cívica y Ética 1",
    "materia": "Formación Cívica y Ética",
    "docente": "Victor Hugo Vargas Velásquez"
  },
  {
    "nivel": "Secundaria",
    "grado": "1º- Primero Secundaria",
    "grupo": "grupo A",
    "clase": "1° A Español Secundaria",
    "Clase Clave": "EspSec1A",
    "Alias": "Español 1",
    "materia": "Lengua Materna. Español",
    "docente": "Arturo Medina Hernández"
  },
  {
    "nivel": "Secundaria",
    "grado": "1º- Primero Secundaria",
    "grupo": "grupo A",
    "clase": "1° A Historia Secundaria",
    "Clase Clave": "HisSec1A",
    "Alias": "Historia 1",
    "materia": "Historia 1",
    "docente": "Arturo Medina Hernández"
  },
  {
    "nivel": "Secundaria",
    "grado": "1º- Primero Secundaria",
    "grupo": "grupo A",
    "clase": "1° A Geografía Secundaria",
    "Clase Clave": "GeoSec1A",
    "Alias": "Geografía",
    "materia": "Geografía",
    "docente": "Arturo Medina Hernández"
  },
  {
    "nivel": "Secundaria",
    "grado": "2º- Segundo Secundaria",
    "grupo": "grupo A",
    "clase": "2° A Matemáticas Secundaria",
    "Clase Clave": "MatSec2A",
    "Alias": "Matemáticas 2",
    "materia": "Matemáticas",
    "docente": "Marco Eduardo Ramírez de la Cruz"
  },
  {
    "nivel": "Secundaria",
    "grado": "2º- Segundo Secundaria",
    "grupo": "grupo A",
    "clase": "2° A Formación Cívica y Ética Secundaria",
    "Clase Clave": "ForSec2A",
    "Alias": "Formación Cívica y Ética 2",
    "materia": "Formación Cívica y Ética",
    "docente": "Victor Hugo Vargas Velásquez"
  },
  {
    "nivel": "Secundaria",
    "grado": "2º- Segundo Secundaria",
    "grupo": "grupo A",
    "clase": "2° A Español Secundaria",
    "Clase Clave": "EspSec2A",
    "Alias": "Español 2",
    "materia": "Lengua Materna. Español",
    "docente": "Arturo Medina Hernández"
  },
  {
    "nivel": "Secundaria",
    "grado": "2º- Segundo Secundaria",
    "grupo": "grupo A",
    "clase": "2° A Historia Secundaria",
    "Clase Clave": "HisSec2A",
    "Alias": "Historia 2",
    "materia": "Historia 2",
    "docente": "Arturo Medina Hernández"
  },
  {
    "nivel": "Secundaria",
    "grado": "2º- Segundo Secundaria",
    "grupo": "grupo A",
    "clase": "2° A Ciencias y tecnología. Física Secundaria",
    "Clase Clave": "CieSec2A",
    "Alias": "Físisca 2",
    "materia": "Ciencias y tecnología. Física",
    "docente": "Francisco Javier De Luna Fernández"
  },
  {
    "nivel": "Secundaria",
    "grado": "3º- Tercero Secundaria",
    "grupo": "grupo A",
    "clase": "3° A Matemáticas Secundaria",
    "Clase Clave": "MatSec3A",
    "Alias": "Matemáticas 3",
    "materia": "Matemáticas",
    "docente": "Marco Eduardo Ramírez de la Cruz"
  },
  {
    "nivel": "Secundaria",
    "grado": "3º- Tercero Secundaria",
    "grupo": "grupo A",
    "clase": "3° A Formación Cívica y Ética Secundaria",
    "Clase Clave": "ForSec3A",
    "Alias": "Formación Cívica y Ética 3",
    "materia": "Formación Cívica y Ética",
    "docente": "Victor Hugo Vargas Velásquez"
  },
  {
    "nivel": "Secundaria",
    "grado": "3º- Tercero Secundaria",
    "grupo": "grupo A",
    "clase": "3° A Español Secundaria",
    "Clase Clave": "EspSec3A",
    "Alias": "Español 3",
    "materia": "Lengua Materna. Español",
    "docente": "Arturo Medina Hernández"
  },
  {
    "nivel": "Secundaria",
    "grado": "3º- Tercero Secundaria",
    "grupo": "grupo A",
    "clase": "3° A Historia Secundaria",
    "Clase Clave": "HisSec3A",
    "Alias": "Historia 3",
    "materia": "Historia 3",
    "docente": "Arturo Medina Hernández"
  },
  {
    "nivel": "Secundaria",
    "grado": "3º- Tercero Secundaria",
    "grupo": "grupo A",
    "clase": "3° A Ciencias y tecnología. Química Secundaria",
    "Clase Clave": "CieSec3A",
    "Alias": "Química 3",
    "materia": "Ciencias y tecnología. Química",
    "docente": "Francisco Javier De Luna Fernández"
  },
  {
    "nivel": "Primaria",
    "grado": "1º- Primero Primaria",
    "grupo": "grupo A",
    "clase": "1° A Inglés Primaria",
    "Clase Clave": "IngPri1A",
    "Alias": "Inglés 1",
    "materia": "Inglés",
    "docente": "Bethoel Teresita Perez Ramirez"
  },
  {
    "nivel": "Primaria",
    "grado": "2º- Segundo Primaria",
    "grupo": "grupo A",
    "clase": "2° A Inglés Primaria",
    "Clase Clave": "IngPri2A",
    "Alias": "Inglés 2",
    "materia": "Inglés",
    "docente": "Bethoel Teresita Perez Ramirez"
  },
  {
    "nivel": "Primaria",
    "grado": "3º- Tercero Primaria",
    "grupo": "grupo A",
    "clase": "3° A Inglés Primaria",
    "Clase Clave": "IngPri3A",
    "Alias": "Inglés 3",
    "materia": "Inglés",
    "docente": "Ana Beatriz Cruz Unda"
  },
  {
    "nivel": "Primaria",
    "grado": "4º- Cuarto Primaria",
    "grupo": "grupo A",
    "clase": "4° A Inglés Primaria",
    "Clase Clave": "IngPri4A",
    "Alias": "Inglés 4",
    "materia": "Inglés",
    "docente": "Ana Beatriz Cruz Unda"
  },
  {
    "nivel": "Primaria",
    "grado": "5º- Quinto Primaria",
    "grupo": "grupo A",
    "clase": "5° A Inglés Primaria",
    "Clase Clave": "IngPri5A",
    "Alias": "Inglés 5",
    "materia": "Inglés",
    "docente": "Beatriz Enriqueta Romero González"
  },
  {
    "nivel": "Primaria",
    "grado": "6º- Sexto Primaria",
    "grupo": "grupo A",
    "clase": "6° A Inglés Primaria",
    "Clase Clave": "IngPri6A",
    "Alias": "Inglés 6",
    "materia": "Inglés",
    "docente": "Beatriz Enriqueta Romero González"
  },
  {
    "nivel": "Secundaria",
    "grado": "1º- Primero Secundaria",
    "grupo": "grupo A",
    "clase": "1° A Inglés Avanzado Secundaria",
    "Clase Clave": "IngSecA",
    "Alias": "Inglés Avanzado",
    "materia": "Inglés Avanzado",
    "docente": "Victor Hugo Vargas Velásquez"
  },
  {
    "nivel": "Secundaria",
    "grado": "1º- Primero Secundaria",
    "grupo": "grupo A",
    "clase": "1° A Inglés Intermedio Secundaria",
    "Clase Clave": "IngSecB",
    "Alias": "Inglés Intermedio",
    "materia": "Inglés Intermedio",
    "docente": "Victor Hugo Vargas Velásquez"
  }
];

    // Referencias a elementos del DOM
    const formReporte = document.getElementById("formReporte");
    const formConsulta = document.getElementById("formConsulta");
    const docenteSelect = document.getElementById("docente");
    const claseSelect = document.getElementById("clase");
    const resultadoDiv = document.getElementById("consultaResultado");
    const modal = document.getElementById("notificacionModal");
    const modalTitle = document.getElementById("modalTitle");
    const modalIcon = document.getElementById("modalIcon");
    const modalMessage = document.getElementById("modalMessage");
    const nivelInput = document.getElementById("nivel");
    const gradoInput = document.getElementById("grado");
    const grupoInput = document.getElementById("grupo");
    const materiaInput = document.getElementById("materia");

    // Función para mostrar la ventana emergente
    function mostrarModal(tipo, titulo, mensaje) {
      modalTitle.textContent = titulo;
      modalMessage.textContent = mensaje;
      modalIcon.innerHTML = '';
      
      if (tipo === 'success') {
        modalIcon.innerHTML = '✅';
        modalIcon.style.color = 'var(--color-primary)';
      } else if (tipo === 'error') {
        modalIcon.innerHTML = '❌';
        modalIcon.style.color = 'var(--color-danger)';
      } else if (tipo === 'info') {
        modalIcon.innerHTML = '🔍';
        modalIcon.style.color = 'var(--color-accent)';
      }
      
      modal.style.display = 'flex';
    }

    // Llenar la lista de DOCENTES al inicio
    function llenarListaDocentes() {
      const docentesUnicos = [...new Set(catalogo.map(item => item.docente))].sort();
      
      docentesUnicos.forEach(d => {
        const opt = document.createElement("option");
        opt.value = d;
        opt.textContent = d;
        docenteSelect.appendChild(opt);
      });
    }

    // Limpiar todos los campos del formulario de reporte
    function limpiarFormulario() {
      formReporte.reset();
      
      // Limpiar campos de solo lectura
      nivelInput.value = "";
      gradoInput.value = "";
      grupoInput.value = "";
      materiaInput.value = "";
      
      // Limpiar y deshabilitar select de clase
      claseSelect.innerHTML = '<option value="">Seleccione...</option>';
      claseSelect.disabled = true;
      
      // Volver a colocar la fecha actual
      document.getElementById("fecha").value = new Date().toLocaleDateString('es-MX');
      
      docenteSelect.selectedIndex = 0;
    }
    
    // ----------------------------------------------------
    // Lógica principal de selección: Docente -> Clase
    // ----------------------------------------------------
    docenteSelect.addEventListener("change", () => {
        claseSelect.innerHTML = '<option value="">Seleccione...</option>';
        claseSelect.disabled = true;
        
        // Limpiar campos dependientes
        nivelInput.value = "";
        gradoInput.value = "";
        grupoInput.value = "";
        materiaInput.value = "";

        const docenteSeleccionado = docenteSelect.value;
        if (!docenteSeleccionado) return;

        // Filtrar clases por el docente seleccionado
        const clasesDocente = catalogo.filter(item => item.docente === docenteSeleccionado);

        clasesDocente.forEach(c => {
          const opt = document.createElement("option");
          opt.value = c.clase;
          opt.textContent = c.clase;
          claseSelect.appendChild(opt);
        });

        claseSelect.disabled = false;
    });


    // Auto-rellenar campos al seleccionar clase
    claseSelect.addEventListener("change", () => {
      const docente = docenteSelect.value;
      const clase = claseSelect.value;
      
      // Busca la combinación exacta de Docente y Clase
      const datos = catalogo.find(item => item.docente === docente && item.clase === clase);

      if (datos) {
        nivelInput.value = datos.nivel;
        gradoInput.value = datos.grado;
        grupoInput.value = datos.grupo;
        materiaInput.value = datos.materia;
      } else {
        // Limpiar campos si se selecciona 'Seleccione...' o no hay match
        nivelInput.value = "";
        gradoInput.value = "";
        grupoInput.value = "";
        materiaInput.value = "";
      }
    });

    // -------------------------------------
    // FUNCIONALIDAD DE GUARDAR REPORTE
    // -------------------------------------
    formReporte.addEventListener('submit', function(event) {
        event.preventDefault(); 
        guardarReporte();
    });

    async function guardarReporte() {
      const btnGuardar = formReporte.querySelector('.guardar');
      btnGuardar.disabled = true;
      mostrarModal('info', 'Enviando...', 'Por favor, espere mientras se procesa su reporte.');

      const reporte = {
        action: "guardar", 
        docente: docenteSelect.value,
        clase: claseSelect.value,
        nivel: nivelInput.value,
        grado: gradoInput.value,
        grupo: grupoInput.value,
        materia: materiaInput.value,
        fecha: document.getElementById("fecha").value,
        descripcion: document.getElementById("descripcion").value,
      };

      try {
        const res = await fetch(API_URL, {
          method: "POST",
          body: JSON.stringify(reporte)
        });

        const data = await res.json(); 

        if (data.success) {
          mostrarModal('success', '¡Reporte Guardado!', `Su reporte ha sido subido correctamente. Su número de ticket es: ${data.ticket}`);
          limpiarFormulario(); 
        } else {
          mostrarModal('error', 'Error al Guardar', "Hubo un problema al guardar el reporte: " + (data.message || "Error desconocido."));
        }

      } catch (err) {
        console.error("Error de red/petición:", err);
        mostrarModal('error', 'Error de Conexión', "No se pudo conectar al servidor. Revise su conexión.");
      } finally {
        btnGuardar.disabled = false;
      }
    }

    function cancelar() {
      if (confirm("¿Desea cancelar el registro actual? Se borrarán todos los datos.")) {
        limpiarFormulario();
      }
    }
    
    // -------------------------------------
    // FUNCIONALIDAD DE CONSULTAR TICKET
    // -------------------------------------
    formConsulta.addEventListener('submit', function(event) {
        event.preventDefault();
        consultarTicket();
    });
    
    function updateResultado(estatus, comentarios) {
        resultadoDiv.className = 'consultaResultado';
        let statusClass = '';
        let statusText = estatus;

        if (estatus && estatus.toLowerCase().includes('pendiente')) {
            statusClass = 'status-pendiente';
        } else if (estatus && estatus.toLowerCase().includes('resuelto')) {
            statusClass = 'status-resuelto';
        } else if (estatus && estatus.toLowerCase().includes('proceso')) {
            statusClass = 'status-enproceso';
        }

        resultadoDiv.innerHTML = `
            <p>Estatus: <strong class="${statusClass}">${statusText || 'N/A'}</strong></p>
            <p>Comentarios: <span>${comentarios || "Aún no hay comentarios."}</span></p>
        `;
    }

    async function consultarTicket() {
      const ticket = document.getElementById("ticketConsulta").value;
      const btnConsultar = formConsulta.querySelector('.consultar');
      btnConsultar.disabled = true;
      
      updateResultado('Buscando...', ''); // Mensaje de búsqueda

      const dataConsulta = {
        action: "consultar", 
        ticket: ticket
      };
      
      try {
        const res = await fetch(API_URL, {
          method: "POST",
          body: JSON.stringify(dataConsulta)
        });
        
        const data = await res.json();
        
        if (data.success) {
            updateResultado(data.estatus, data.comentarios);
            mostrarModal('info', 'Consulta Exitosa', `Estatus del Ticket ${ticket}: ${data.estatus}`);
        } else {
            resultadoDiv.innerHTML = '<p style="color:var(--color-danger);">❌ Ticket no encontrado.</p>';
            mostrarModal('error', 'Error de Consulta', data.message || `El ticket ${ticket} no fue encontrado o el número es incorrecto.`);
        }

      } catch (err) {
        console.error("Error de red/petición:", err);
        resultadoDiv.innerHTML = '<p style="color:var(--color-danger);">⚠️ Error de conexión.</p>';
        mostrarModal('error', 'Error de Conexión', "No se pudo conectar al servidor.");
      } finally {
        btnConsultar.disabled = false;
      }
    }

    // Inicialización al cargar la página
    document.addEventListener("DOMContentLoaded", () => {
        llenarListaDocentes();
        limpiarFormulario(); // Inicializar campos de solo lectura, fecha y deshabilitar Clase
        // Inicializar el div de resultado de consulta
        resultadoDiv.innerHTML = '<p>Estatus:</p><p>Comentarios:</p>';
    });
  </script>
</body>
</html>

